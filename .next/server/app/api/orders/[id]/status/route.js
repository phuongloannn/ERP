(()=>{var e={};e.id=55,e.ids=[55],e.modules={2849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2849,e.exports=t},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},1808:e=>{"use strict";e.exports=require("net")},7282:e=>{"use strict";e.exports=require("process")},2781:e=>{"use strict";e.exports=require("stream")},1576:e=>{"use strict";e.exports=require("string_decoder")},9512:e=>{"use strict";e.exports=require("timers")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},191:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>p});var s={};r.r(s),r.d(s,{PUT:()=>n});var o=r(9303),a=r(8716),u=r(670),i=r(9487);async function n(e,{params:t}){try{let r=parseInt(t.id),{status:s}=await e.json();console.log("Update status request:",{orderId:r,status:s});let o=["pending","preparing","ready","delivering","completed","cancelled"];if(!s||!o.includes(s))return Response.json({success:!1,error:`Invalid status. Must be one of: ${o.join(", ")}`},{status:400});let a=`
      UPDATE orders 
      SET status = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `;await i.db.query(a,[s,r]),console.log("Status updated successfully");let u=await i.db.query("SELECT * FROM orders WHERE id = ?",[r]),n=null;if(Array.isArray(u)?u.length>0&&(n=u[0]):u&&"object"==typeof u&&(n=u),"completed"===s)try{await i.db.query("UPDATE orders SET completed_at = CURRENT_TIMESTAMP WHERE id = ?",[r]),n&&(n.completed_at=new Date().toISOString())}catch(e){console.warn("Could not update completed_at:",e)}try{await i.db.query("INSERT INTO order_status_logs (order_id, status, changed_at) VALUES (?, ?, NOW())",[r,s]),console.log("Status change logged")}catch(e){console.warn("Could not log status change:",e)}return Response.json({success:!0,message:`Order ${r} updated to ${s}`,data:n||{id:r,status:s}})}catch(t){console.error("Error updating order status:",t);let e="Failed to update order status";return"ER_NO_SUCH_TABLE"===t.code?e="Orders table does not exist or wrong schema":"ER_BAD_FIELD_ERROR"===t.code&&(e="Invalid column name in query"),Response.json({success:!1,error:e,details:t.message,sql:t.sql},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/orders/[id]/status/route",pathname:"/api/orders/[id]/status",filename:"route",bundlePath:"app/api/orders/[id]/status/route"},resolvedPagePath:"D:\\ERP\\app\\api\\orders\\[id]\\status\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:l}=d,E="/api/orders/[id]/status/route";function g(){return(0,u.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:p})}},9487:(e,t,r)=>{"use strict";r.d(t,{db:()=>o});let s=r(3785).createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"fried_chicken_4s",port:Number(process.env.DB_PORT)||3306,waitForConnections:!0,connectionLimit:10,queueLimit:0}),o={query:async(e,t)=>{try{let r=await s.getConnection();try{let[s]=await r.execute(e,t||[]);return s}finally{r.release()}}catch(e){throw console.error("[DB] Database query error:",e),e}}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,898],()=>r(191));module.exports=s})();